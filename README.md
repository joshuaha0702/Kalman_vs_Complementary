# Lab 06: 칼만 필터를 활용한 1축 기울기 각도 측정 및 분석 보고서

## 1. 실험 개요
본 실험은 가속도 센서(Accelerometer)와 자이로 센서(Gyroscope)를 융합(Sensor Fusion)하여 노이즈가 제거된 정확한 기울기 각도($\theta$)를 추정하는 것을 목표로 한다. 이를 위해 두 가지 서로 다른 모델의 **칼만 필터(Kalman Filter)**를 설계하고, 이를 전통적인 **상보 필터(Complementary Filter)**와 비교 분석한다.

## 2. 실험 모델 정의

실험에서는 자이로 센서 데이터를 다루는 방식에 따라 두 가지 모델을 적용하였다.

### Method 1: 자이로를 제어 입력(Input)으로 사용하는 모델 (Recommended)
* [cite_start]**교재 모델:** Model 2 [cite: 97]
* **특징:** 물리적 운동 방정식($\theta = \int \omega dt$)에 기반하여 자이로를 상태 전이의 입력($u$)으로 사용한다.
* **상태 변수:** $x = [\theta, \beta]^T$ (각도, 자이로 바이어스)
* **시스템 모델:**
  $$x_{k+1} = A x_k + B u_k + w_k$$
  $$z_k = H x_k + v_k$$
  (여기서 $u_k$는 자이로 측정값 $\omega$, $z_k$는 가속도 기반 각도 $\theta_{acc}$) [cite_start][cite: 113, 117]
* **노이즈 공분산:**
  * $R$ (측정 노이즈): 스칼라 값 (가속도 센서의 분산)
  * $Q$ (프로세스 노이즈): 자이로 센서의 불확실성 및 바이어스 변화

### Method 2: 자이로를 측정치(Measurement)로 사용하는 모델
* [cite_start]**교재 모델:** Model 1 [cite: 76]
* **특징:** 가속도와 자이로 값을 모두 관측된 결과($z$)로 취급한다.
* **상태 변수:** $x = [\theta, \omega]^T$
* **시스템 모델:**
  $$z_k = \begin{bmatrix} \theta_{acc} \\ \omega_{gyro} \end{bmatrix} = H x_k + v_k$$
  [cite_start][cite: 92]
* **노이즈 공분산:**
  * $R$: $2 \times 2$ 행렬 (가속도와 자이로 각각의 분산 $\begin{bmatrix} \sigma_a^2 & 0 \\ 0 & \sigma_g^2 \end{bmatrix}$)

---

## 3. 파라미터 튜닝 및 결과 (Tuning Process)

초기 실험 시 가속도 센서의 심한 노이즈가 필터 결과에 그대로 반영되는 현상(Jittering)이 발생하였으나, $Q$와 $R$ 값의 조정을 통해 해결하였다.

### 3.1 튜닝 파라미터 설정
* **$R$ (Measurement Noise Covariance): `1`**
    * 초기 설정보다 값을 크게(Over-estimated) 설정하여 가속도 센서의 고주파 노이즈를 효과적으로 차단함.
    * 센서 데이터 시트 값보다 크게 설정함으로써 필터가 측정값보다 예측값을 더 신뢰하도록 유도(Smoothing 효과).
* **$Q$ (Process Noise Covariance): `0.001`**
    * 매우 작은 값으로 설정하여 자이로 센서를 통한 예측 모델(시스템 모델)을 강하게 신뢰하도록 설정.
    * 자이로 센서의 단기 정확성을 최대한 활용함.

### 3.2 실험 결과 비교
* [cite_start]**상보 필터 vs 칼만 필터:** 튜닝 후 칼만 필터의 출력 파형이 상보 필터(Complementary Filter)의 결과와 거의 일치함(Overlap)을 확인하였다. [cite: 94]
* **이유:** 정상 상태(Steady State)에서 일정한 $Q, R$ 비율을 가진 칼만 필터의 게인($K$)은 상보 필터의 가중치($\alpha$)와 수학적으로 유사한 값으로 수렴하기 때문이다.

---

## 4. 고찰: 왜 Method 1(Input 방식)이 더 우수한가?

두 방식의 결과 그래프가 유사함에도 불구하고, 공학적으로 **Method 1(자이로를 입력으로 사용)**을 채택하는 것이 타당하며 그 이유는 다음과 같다.

1.  **물리적 모델의 타당성 (Physics-based Modeling)**
    * 각도는 각속도의 적분이라는 물리 법칙에 따라, 자이로($\omega$)는 상태를 변화시키는 원인(Input)으로 보는 것이 자연스럽다.
    * Method 2는 속도 성분을 단순히 '관측'하는 것으로 처리하여 운동학적 인과관계를 약하게 반영한다.

2.  **위상 지연 최소화 (Low Latency)**
    * **Method 1:** 자이로 값이 입력되는 즉시 `Time Update(Predict)` 단계에서 각도 상태에 반영되므로 지연(Lag)이 거의 없다.
    * **Method 2:** 자이로 값이 `Measurement Update(Correct)` 단계에서 칼만 게인($K$)을 거쳐 반영되므로, 급격한 기동 시 미세한 위상 지연이 발생할 수 있다.

3.  **자이로 바이어스 추정 (Bias Estimation)**
    * [cite_start]**Method 1**은 상태 변수에 `Bias`($\beta$)를 포함하여[cite: 113], 시간이 지남에 따라 자이로 센서의 오차(Drift)를 스스로 학습하고 제거할 수 있다.
    * 이는 장시간 운용 시 드리프트가 누적되는 자이로 센서의 치명적인 단점을 보완하는 핵심 기능이다.

## 5. 결론

본 실험을 통해 $Q=0.001$, $R=1$의 튜닝 값을 도출하였으며, 이를 통해 가속도 센서의 노이즈를 제거하고 자이로 센서의 동적 특성을 잘 반영한 기울기 측정 결과를 얻었다.

두 모델과 상보 필터 모두 유사한 파형을 보였으나, **시스템의 반응 속도(Response time)**와 **센서 오차 보정(Drift cancellation)** 측면에서 확장성이 뛰어난 **Method 1 (Model 2)** 방식이 가장 적합한 알고리즘으로 판단된다.